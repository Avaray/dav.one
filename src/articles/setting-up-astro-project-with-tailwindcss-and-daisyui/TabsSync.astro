<!-- src/components/TabsSync.astro -->
<script>
  // Shared function to change tab state
  const changeTab = (button: HTMLButtonElement): void => {
    const container = button.closest('[data-tabs]');
    if (!container) return;

    const tabIndex = parseInt(button.getAttribute('data-tab-index') || '0');
    const buttons = container.querySelectorAll('.tab-button');
    const panels = container.querySelectorAll('.tab-panel');

    // Deselect all buttons
    buttons.forEach((btn) => btn.setAttribute('aria-selected', 'false'));

    // Hide all panels
    panels.forEach((panel) => panel.classList.add('hidden'));

    // Select clicked button
    button.setAttribute('aria-selected', 'true');

    // Show corresponding panel
    panels[tabIndex].classList.remove('hidden');
  };

  let syncTabs = (): void => {
    document.addEventListener('click', (event: Event): void => {
      const target = event.target as HTMLElement;
      if (!(target instanceof HTMLButtonElement && target.matches('.tab-button'))) return;

      const label = target.textContent?.trim();
      if (!label) return;

      // Change state in all containers immediately
      const allContainers = document.querySelectorAll('[data-tabs]');
      allContainers.forEach((container) => {
        const buttons = container.querySelectorAll('.tab-button');
        buttons.forEach((btn) => {
          if (btn.textContent?.trim() === label) {
            changeTab(btn as HTMLButtonElement);
          }
        });
      });
    });
  };

  document.addEventListener('DOMContentLoaded', syncTabs);
  document.addEventListener('astro:page-load', syncTabs);
</script>
