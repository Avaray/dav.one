---
import { getCollection } from 'astro:content';
import { siteTitle, siteDescription } from '@/consts.ts';

import PageLayout from '@/layouts/PageLayout.astro';
import IndexEntry from '@components/reusables/IndexEntry.astro';

const articles = await getCollection('articles', ({ data }) => {
  return import.meta.env.PRODUCTION_BUILD ? data.draft !== true : true;
});

const sortedArticles = [...articles].sort((a, b) => {
  const dateA = new Date(a.data.updated || a.data.created).getTime();
  const dateB = new Date(b.data.updated || b.data.created).getTime();
  return dateB - dateA;
});
---

<PageLayout title={siteTitle} description={siteDescription}>
  {sortedArticles.map((article) => <IndexEntry article={article} />)}
</PageLayout>
