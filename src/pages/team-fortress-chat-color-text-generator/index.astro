---
import Head from '@components/Head.astro';
import './_styles.css';
import { COLOR_PALETTES } from './colorizer.js';

const title = 'TF2 Colorizer';
const description = 'TF2 Colored Text Generator';
---

<!doctype html>
<html lang='en'>
  <Head title={title} description={description} ignoreGlobalStyles />
  <body class='bg-[#0f1014] text-slate-200 min-h-screen font-sans flex flex-col items-center justify-center p-4'>
    <main class='w-full max-w-5xl space-y-6'>
      {/* --- EDITOR STACK --- */}
      <div class='relative w-full bg-[#16181d] border border-slate-800 rounded-xl shadow-2xl overflow-hidden group'>
        {/* Top Bar */}
        <div class='flex justify-between items-center px-4 py-3 bg-[#1e2026] border-b border-slate-800'>
          <div class='flex gap-2 opacity-50'>
            <div class='w-3 h-3 rounded-full bg-slate-600'></div>
            <div class='w-3 h-3 rounded-full bg-slate-600'></div>
            <div class='w-3 h-3 rounded-full bg-slate-600'></div>
          </div>
          <span id='char-count' class='text-xs font-mono text-slate-500'>0/127</span>
        </div>

        {/* EDITOR LAYER AREA */}
        <div class='relative h-64 w-full text-lg font-mono leading-relaxed'>
          {/* Layer 1: Backdrop (Syntax Highlighting) - BELOW */}
          {/* pointer-events-none ensures clicks go through to textarea */}
          <div
            id='editor-backdrop'
            class='absolute inset-0 p-6 whitespace-pre-wrap break-words pointer-events-none overflow-hidden'
            aria-hidden='true'
          >
          </div>

          {/* Layer 2: Textarea (User Input) - ABOVE */}
          {/* text-transparent hides raw text, but caret-white keeps cursor visible */}
          <textarea
            id='input-text'
            class='absolute inset-0 w-full h-full p-6 bg-transparent text-transparent caret-white resize-none border-0 focus:ring-0 focus:outline-none z-10 whitespace-pre-wrap break-words overflow-auto custom-scrollbar selection:bg-white/10 selection:text-transparent'
            spellcheck='false'
            placeholder='Type here...'></textarea>
        </div>

        {/* Bottom Bar */}
        <div class='p-4 bg-[#1e2026] border-t border-slate-800 flex items-center justify-between'>
          <div class='flex items-center gap-3'>
            <div
              class='relative group cursor-pointer flex items-center gap-2 px-3 py-1.5 bg-black/40 rounded border border-slate-700 hover:border-slate-500 transition-colors'
            >
              <div class='w-4 h-4 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 border border-white/10'>
              </div>
              <input type='color' id='custom-color' class='absolute inset-0 opacity-0 cursor-pointer' />
              <span class='text-xs font-bold text-slate-400'>PICKER</span>
            </div>
            <button
              id='btn-reset-tag'
              class='px-3 py-1.5 text-xs font-bold bg-slate-800 text-slate-400 rounded hover:bg-slate-700 border border-transparent hover:border-slate-600 transition-colors'
            >
              RESET
            </button>
          </div>

          <button
            id='copy-btn'
            class='px-6 py-2 bg-gradient-to-r from-orange-700 to-orange-600 hover:from-orange-600 hover:to-orange-500 text-white font-bold text-sm rounded shadow-lg hover:shadow-orange-500/20 active:translate-y-0.5 transition-all flex items-center gap-2'
          >
            <span>COPY TEXT</span>
            <span id='copy-feedback' class='text-green-300 opacity-0 transition-opacity text-xs ml-2 font-mono'
              >OK!</span
            >
          </button>
        </div>
      </div>

      {/* --- PALETTES GRID --- */}
      <div class='grid grid-cols-2 md:grid-cols-5 gap-4'>
        {
          Object.entries(COLOR_PALETTES).map(([category, colors]) => (
            <div class='bg-[#16181d] border border-slate-800/50 rounded-lg p-3 hover:border-slate-700 transition-colors'>
              <h3 class='text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 text-center border-b border-slate-800 pb-2'>
                {category}
              </h3>
              <div class='flex flex-wrap justify-center gap-1.5'>
                {colors.map((color) => (
                  <button
                    class='js-color-btn group relative w-8 h-8 rounded-md hover:scale-110 hover:z-10 transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#16181d] focus:ring-slate-500 shadow-sm'
                    style={`background-color: #${color.hex};`}
                    data-hex={color.hex}
                    title={`${color.name}`}
                  >
                    <span class='absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-900 text-slate-200 text-xs rounded border border-slate-700 opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none z-20 font-sans shadow-xl'>
                      {color.name}
                    </span>
                  </button>
                ))}
              </div>
            </div>
          ))
        }
      </div>

      <footer class='text-center pt-8 opacity-50 hover:opacity-100 transition-opacity'>
        <p class='text-xs text-slate-500'>
          Works in <span class='text-slate-300'>Team Chat</span> and <span class='text-slate-300'>Dead Chat</span>.
        </p>
      </footer>
    </main>

    <script>
      import { initColorizer } from './colorizer.js';
      document.addEventListener('DOMContentLoaded', initColorizer);
    </script>

    <style is:global>
      /* CRITICAL: Perfect alignment for the stack */
      #editor-backdrop,
      #input-text {
        font-family: 'JetBrains Mono', 'Menlo', 'Courier New', monospace;
        font-size: 1.125rem; /* 18px */
        line-height: 1.625;
        letter-spacing: normal;
      }

      /* Hide scrollbar but keep functionality */
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    </style>
  </body>
</html>
